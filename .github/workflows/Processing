name: Test JSON Processing

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Install jq
      run: |
        sudo apt-get update
        sudo apt-get install -y jq

    - name: Test JSON processing
      run: |
        echo "=== Current files ==="
        ls -la
        
        echo "=== images.json content ==="
        cat images.json
        
        echo "=== Test JSON processing ==="
        # Simple test
        echo "Count: $(jq 'length' images.json)"
        
        # Test first item
        echo "First source: $(jq -r '.[0].source' images.json)"
        echo "First target: $(jq -r '.[0].target' images.json)"
        echo "First tag count: $(jq '.[0].tags | length' images.json)"
        
        # Test all items with loop
        count=$(jq 'length' images.json)
        for i in $(seq 0 $((count-1))); do
          echo "Item $i:"
          echo "  Source: $(jq -r ".[$i].source" images.json)"
          echo "  Target: $(jq -r ".[$i].target" images.json)"
          tag_count=$(jq ".[$i].tags | length" images.json)
          echo "  Tag count: $tag_count"
          for j in $(seq 0 $((tag_count-1))); do
            echo "    Tag $j: $(jq -r ".[$i].tags[$j]" images.json)"
          done
        done
